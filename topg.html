<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sadece YÃ¶rÃ¼nge SimÃ¼lasyonu - Top Terminolojisi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; gap: 20px; }
        #controls { width: 300px; padding: 15px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { width: 80px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #canvasContainer { flex-grow: 1; border: 1px solid #ddd; background-color: #e0f7fa; border-radius: 8px; }
        #mesaj { font-weight: bold; margin-top: 10px; padding: 10px; border-radius: 4px; }
        .gol { color: #28a745; background-color: #d4edda; }
        .hata { color: #dc3545; background-color: #f8d7da; }
        .info { color: #0056b3; background-color: #cce5ff; }
    </style>
</head>
<body>
<div id="controls">
    <h3>AtÄ±ÅŸ Kontrolleri</h3>
    HÄ±z (m/s): <input type="number" id="hizInput" value="15" min="0" step="0.1"><br><br>
    AÃ§Ä± (Â°): <input type="number" id="aciInput" value="53" min="0" max="90" step="0.1"><br><br>
    <button id="shootBtn">AtÄ±ÅŸÄ± BaÅŸlat</button><br><br>
    
    <hr>
    
    <h3>Sabitler: $G=10\text{ m/s}^2, \cos(53^\circ)=0.6, \sin(53^\circ)=0.8$</h3>
    
    <hr>
    
    <h3>AnlÄ±k Durum</h3>
    <p>SÃ¼re (t): <span id="currentT">0.00</span> s</p>
    <p>X Konumu: <span id="currentX">0.00</span> m</p>
    <p>Y Konumu: <span id="currentY">0.00</span> m</p>
    
    <hr>
    
    <p id="mesaj"></p>
    <p>Skor (Gol SayÄ±sÄ±): <span id="skor">0</span></p>
</div>

<div id="canvasContainer"></div>

<script>
// --- SABÄ°T DEÄžERLER ---
const G = 10.0; // YerÃ§ekimi ivmesi (m/sÂ²)
const COS_53_CUSTOM = 0.6;
const SIN_53_CUSTOM = 0.8; 

const DT = 0.02; 
const KALE_X_METRIC = 19.8; // Kale X mesafesi (m)
const KALE_Y_METRIC = 2.2; // Kale YÃ¼ksekliÄŸi (m)
const TOP_RADIUS_TOLERANCE = 0.05; 
const KALE_GENISLIGI_PX = 30; // Kale direÄŸi gÃ¶rsel kalÄ±nlÄ±ÄŸÄ±

let scale = 20; 
let groundY; 

// --- DEÄžÄ°ÅžKENLER ---
let v0 = 15;
let angle = 53;
let t = 0;
let x_metric = 0, y_metric = 0;
let trajectory = []; // YÃ¶rÃ¼nge noktalarÄ± hala burada tutuluyor
let skor = 0;
let shooting = false;
let obstaclePassed = false; 

// --- DOM ELEMANLARI ---
const hizInput = document.getElementById('hizInput');
const aciInput = document.getElementById('aciInput');
const shootBtn = document.getElementById('shootBtn');
const mesaj = document.getElementById('mesaj');
const skorSpan = document.getElementById('skor');
const currentTSpan = document.getElementById('currentT');
const currentXSpan = document.getElementById('currentX');
const currentYSpan = document.getElementById('currentY');

shootBtn.addEventListener('click', () => {
    v0 = Number(hizInput.value);
    angle = Number(aciInput.value);
    
    if (isNaN(v0) || isNaN(angle) || v0 < 0 || angle < 0 || angle > 90) {
        mesaj.innerText = "Hata: LÃ¼tfen geÃ§erli hÄ±z ve aÃ§Ä± girin (0-90 arasÄ± aÃ§Ä±).";
        mesaj.className = "hata";
        return;
    }
    
    let cosTheta = (angle === 53) ? COS_53_CUSTOM : cos(radians(angle));
    if (Math.abs(v0 * cosTheta) < 0.01) { 
         mesaj.innerText = "Hata: Top yatayda hareket edemez.";
         mesaj.className = "hata";
         return;
    }
    
    resetSim();
    shooting = true;
    loop(); 
});

function resetSim() {
    t = 0;
    x_metric = 0;
    y_metric = 0;
    trajectory = [];
    mesaj.innerText = "Top atÄ±ÅŸÄ± bekleniyor...";
    mesaj.className = "info";
    obstaclePassed = false;
    updateDisplay(0, 0, 0);
}

function setup() {
    let container = document.getElementById('canvasContainer');
    let canvas = createCanvas(container.clientWidth, 400);
    canvas.parent('canvasContainer');
    groundY = height - 50; 
    noLoop(); 
    resetSim(); 
}

function draw() {
    background(240);

    // --- Zemin ve Kale Ã‡izimi ---
    stroke(0);
    line(0, groundY, width, groundY); 

    let kaleXPx = KALE_X_METRIC * scale; 
    let kaleYPx = KALE_Y_METRIC * scale; 
    
    // Kale Ã§izimi (Duvar ÅŸeklinde)
    noStroke();
    fill(200, 50, 50, 150); 
    rect(kaleXPx, groundY - kaleYPx, KALE_GENISLIGI_PX, kaleYPx); 
    
    // Kale Ã¼st Ã§izgisini belirginleÅŸtir
    stroke(150, 0, 0); 
    strokeWeight(4);
    line(kaleXPx, groundY - kaleYPx, kaleXPx + KALE_GENISLIGI_PX, groundY - kaleYPx);

    // Kale etiketini yerleÅŸtir
    fill(50);
    textSize(14);
    textAlign(CENTER);
    text(`KALE (2.2m)`, kaleXPx + KALE_GENISLIGI_PX / 2, groundY - kaleYPx - 15);
    strokeWeight(1); 

    if (!shooting) return;

    // --- Fizik HesaplarÄ± (Metrik) ---
    
    let cosTheta = (angle === 53) ? COS_53_CUSTOM : cos(radians(angle));
    let sinTheta = (angle === 53) ? SIN_53_CUSTOM : sin(radians(angle));
    
    x_metric = v0 * cosTheta * t;
    y_metric = v0 * sinTheta * t - 0.5 * G * t * t; 
    
    // Yere DÃ¼ÅŸme KontrolÃ¼
    if (y_metric < 0) {
        y_metric = 0; 
        
        let finalResult = checkResult(x_metric, y_metric);
        mesaj.innerText = finalResult.message;
        mesaj.className = finalResult.className;
        
        shooting = false;
        noLoop();
        return;
    }
    
    // YÃ¶rÃ¼nge kaydÄ±
    trajectory.push([x_metric, y_metric]);

    // --- PÄ°KSEL KONUMLARI ---
    let x_px = x_metric * scale;
    let y_px = y_metric * scale;
    
    // --- YÃ–RÃœNGE Ã‡Ä°ZÄ°MÄ° ---
    // YÃ¶rÃ¼nge hala Ã§izilir, sadece mesajlarda "top" denir
    stroke(0,0,255);
    strokeWeight(3); 
    noFill();
    beginShape();
    for (let i = 0; i < trajectory.length; i++) {
        let tx = trajectory[i][0] * scale;
        let ty = trajectory[i][1] * scale;
        vertex(tx, groundY - ty); 
    }
    endShape();
    strokeWeight(1);
    
    // Topun merkezini gÃ¶steren kÃ¼Ã§Ã¼k daire
    fill(255, 0, 0); 
    noStroke();
    ellipse(x_px, groundY - y_px, 6, 6);


    // --- ANLIK KONTROL: Top X=19.8m'ye ulaÅŸtÄ±ÄŸÄ± an ---
    if (!obstaclePassed && x_metric >= KALE_X_METRIC) {
        
        let finalResult = checkResult(x_metric, y_metric);
        mesaj.innerText = finalResult.message;
        mesaj.className = finalResult.className;
        
        if (finalResult.isGoal) {
            skor++;
            skorSpan.innerText = skor;
        }

        obstaclePassed = true; 
        shooting = false;
        noLoop();
        return;
    }

    // --- SÃœRE VE HAREKET GÃœNCELLEMESÄ° ---
    updateDisplay(t, x_metric, y_metric);
    t += DT;

    // --- DURDURMA KOÅžULU (Ã‡ok UzaÄŸa Gitti) ---
    if (x_px > width) { 
        shooting = false;
        if (!obstaclePassed) { 
             mesaj.innerText = "Hata: Top kaleye ulaÅŸmadan Ã§ok uzaÄŸa gitti. ðŸš€";
             mesaj.className = "hata";
        }
        noLoop();
    }
}

// SonuÃ§larÄ± mantÄ±ksal olarak hesaplayan tek fonksiyon
function checkResult(finalX, finalY) {
    
    const isGround = finalY < TOP_RADIUS_TOLERANCE;

    // 1. Durum: Kale Mesafesine UlaÅŸÄ±ldÄ± (X >= 19.8 m)
    if (finalX >= KALE_X_METRIC - TOP_RADIUS_TOLERANCE) {
        
        // GOL KoÅŸulu: Yere dÃ¼ÅŸmediyse (Y > 0) VE kale yÃ¼ksekliÄŸini aÅŸmadÄ±ysa (Y <= 2.2m)
        if (!isGround && finalY <= KALE_Y_METRIC + TOP_RADIUS_TOLERANCE) {
            return {
                message: `GOL! âš½ Top Kaleye Girdi! (t = ${t.toFixed(2)} s, YÃ¼kseklik: ${finalY.toFixed(2)} m)`,
                className: "gol",
                isGoal: true
            };
        }
        
        // Hata KoÅŸulu 1: Kaleyi AÅŸtÄ± (Y > 2.2m)
        else if (finalY > KALE_Y_METRIC + TOP_RADIUS_TOLERANCE) {
             return {
                message: `Hata: Top Kaleyi AÅŸtÄ±! (YÃ¼kseklik: ${finalY.toFixed(2)} m)`,
                className: "hata",
                isGoal: false
            };
        }
        
        // Hata KoÅŸulu 2: Yere DÃ¼ÅŸtÃ¼ (Y=0)
        else { 
             return {
                message: "Hata: Top Kaleye UlaÅŸamadan Yere DÃ¼ÅŸtÃ¼. ðŸ’¥",
                className: "hata",
                isGoal: false
            };
        }
    }
    
    // 2. Durum: Kale Mesafesine UlaÅŸÄ±lamadan Yere DÃ¼ÅŸtÃ¼ (X < 19.8 m ve Y=0)
    else {
        return {
             message: "Hata: Top Kaleye UlaÅŸamadan Yere DÃ¼ÅŸtÃ¼. ðŸ’¥",
             className: "hata",
             isGoal: false
        };
    }
}

function updateDisplay(t_val, x_val, y_val) {
    currentTSpan.textContent = t_val.toFixed(2);
    currentXSpan.textContent = x_val.toFixed(2);
    currentYSpan.textContent = y_val.toFixed(2);
}

// Pencere boyutu deÄŸiÅŸirse canvas'Ä± yeniden boyutlandÄ±r
function windowResized() {
    let container = document.getElementById('canvasContainer');
    resizeCanvas(container.clientWidth, 400);
    groundY = height - 50;
}
</script>
</body>
</html>